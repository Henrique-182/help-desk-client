<div class="knowledges-container">
    <div class="knowledges__toolbar width-100">
        <div class="logo flex align-items-center justify-content-center">
            <p-button text="true" [style]="{'color': '#fff'}" icon="pi pi-desktop" size="large"/>
        </div>
        <p-toolbar>
            <ng-template pTemplate="start">
            </ng-template>
            <ng-template pTemplate="end">
                <span>Olá, {{ username }}</span>
            </ng-template>
        </p-toolbar>
    </div>
    <div class="knowledges_sidebar">
        <p-sidebar [visible]="true" modal="false" class="flex flex-column align-items-center justify-content-center">
            <ul>
            </ul>
        </p-sidebar>
    </div>
    <div class="content">
        <div class="knowledges__breadcrumb">
            <p-breadcrumb [model]="breadCrumbItems" />
        </div>
        <div class="knowledges__table">
            <p-table 
                [value]="tableValue" 
                [lazy]="true" 
                [rows]="rows" 
                [totalRecords]="totalElements"
                paginator="true" 
                [showCurrentPageReport]="true" 
                currentPageReportTemplate="{first} - {last} de um total de {totalRecords} conhecimentos"
                (onPage)="handlePageEvent($event)" 
                [rowsPerPageOptions]="[5, 10, 25]"
                [sortField]="'title'"
                (onSort)="handleSortEvent($event)"
                styleClass="p-datatable-sm"
            >
                <!-- TABLE CAPTION -->
                <ng-template pTemplate="caption">
                    <div class="flex align-items-center justify-content-space-between">
                    <div>
                        <p-button [outlined]="true" icon="pi pi-filter-slash" label="Limpar filtros" (click)="onClearFilters()" class="margin-right-1-em" />
                        <p-button [outlined]="true" icon="pi pi-refresh" label="Recarregar" (click)="onRefreshTable()" />
                    </div>
                    <div>
                        <p-button [outlined]="true" severity="success" icon="pi pi-plus" label="Incluir" (click)="onAddKnowledge()" class="margin-right-1-em" />
                        <p-button [outlined]="true" severity="help" icon="pi pi-file-pdf" label="Report" (click)="onKnowledgeReport()" />
                    </div>
                </div>
                </ng-template>
    
                <!-- TABLE HEADER -->
                <ng-template pTemplate="header">
                    <tr>
                        <th pSortableColumn="id">
                            Id 
                            <p-sortIcon field="id" />
                        </th>
                        <th pSortableColumn="title">
                            <div class="flex justify-content-space-between align-items-center">
                                <div>
                                    Título
                                    <p-sortIcon field="title" />
                                </div>
                                <div>
                                    <p-columnFilter
                                    ariaLabel="Filtra conhecimento"
                                    display="menu"
                                    [showMatchModes]="false"
                                    [showOperator]="false"
                                    [showAddButton]="false"
                                    [showClearButton]="false"
                                    >
                                    <ng-template pTemplate="filter">
                                        <input type="text" placeholder="Busca por título" pInputText [(ngModel)]="queryTitle">
                                    </ng-template>
                                    </p-columnFilter>
                                </div>
                            </div>
                        </th>
                        <th>
                            <div class="flex justify-content-space-between align-items-center">
                                <div>
                                    Tags
                                </div>
                                <div>
                                <p-columnFilter 
                                    field="enabled"
                                    ariaLabel="Filtra conhecimento"
                                    display="menu"
                                    [showMatchModes]="false"
                                    [showOperator]="false"
                                    [showAddButton]="false"
                                    [showClearButton]="false"
                                >
                                    <ng-template pTemplate="filter">
                                    <p-dropdown [(ngModel)]="queryTag" [options]="tags" placeholder="Busca por tag">
                                        <ng-template let-tag pTemplate="item">
                                            <p-tag [value]="tag.label" />
                                        </ng-template>
                                    </p-dropdown>
                                    </ng-template>
                                </p-columnFilter>
                                </div>
                            </div>           
                        </th>
                        <th>
                            Ações
                        </th>
                    </tr>
                </ng-template>
    
                <!-- TABLE BODY -->
                <ng-template pTemplate="body" let-knowledge>
                    <tr>
                    <td>{{ knowledge.key }}</td>
                    <td>{{ knowledge.title }}</td>
                    <td>
                        <p-tag 
                        *ngFor="let d of knowledge.tags" 
                        [value]="d.description"  
                        [rounded]="true"
                        />
                    </td>
                    <td>
                        <p-button 
                        pRipple
                        icon="pi pi-info-circle" 
                        [rounded]="true" 
                        [outlined]="true" 
                        severity="info" 
                        (click)="onGetKnowledge(knowledge)" />
                        <p-button 
                        pRipple
                        icon="pi pi-pencil" 
                        [rounded]="true" 
                        [outlined]="true" 
                        severity="success" 
                        (click)="onEditKnowledge(knowledge)" />
                        <p-button 
                        pRipple 
                        icon="pi pi-trash" 
                        severity="danger" 
                        [rounded]="true" 
                        [outlined]="true"
                        (click)="onDeleteKnowledge(knowledge)" />
                    </td>
                    </tr>
                </ng-template>
    
            </p-table>
        </div>
    </div>
</div>